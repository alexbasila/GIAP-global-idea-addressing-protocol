

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>GIAP · Churchen (MVP)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{--w:900px}
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;margin:0;background:#fafafa;color:#111}
  header{padding:0;background:#fff;border-bottom:1px solid #eee}
  main{max-width:var(--w);margin:0 auto;padding:18px}
  h1{margin:0 0 6px;font-size:28px}
  h2{margin:0 0 10px}
  .card{background:#fff;border:1px solid #eee;border-radius:12px;padding:16px;margin:12px 0;box-shadow:0 4px 18px rgba(0,0,0,.04)}
  .hero{max-width:var(--w);margin:0 auto;padding:36px 16px 22px 16px;text-align:center}
  .hero h1{font-size:32px;margin:0 0 8px}
  .lead{color:#555}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  textarea{width:100%;min-height:140px;padding:12px;border:1px solid #ddd;border-radius:10px;font:inherit}
  input[type=text]{width:100%;padding:10px;border:1px solid #ddd;border-radius:10px;font:inherit}
  button{padding:10px 14px;border-radius:10px;border:1px solid #111;background:#111;color:#fff;font-weight:600;cursor:pointer}
  button.secondary{background:#fff;color:#111}
  code{background:#f2f2f2;border-radius:6px;padding:2px 6px}
  .muted{color:#666;font-size:14px}
  .table{width:100%;border-collapse:collapse}
  .table th,.table td{padding:8px;border-bottom:1px solid #eee;text-align:left;font-size:14px;vertical-align:top}
  .pill-btn{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #111;background:#fff;color:#111;font-size:12px;cursor:pointer}
  .pill-btn + .pill-btn{margin-left:6px}
  /* Judge-Overlay */
  #judge-overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:10000;display:grid;place-items:center;padding:16px}
  #judge-card{background:#fff;border-radius:12px;max-width:820px;width:100%;padding:18px;box-shadow:0 12px 36px rgba(0,0,0,.25)}
  /* Floating Judge Button */
  #judge-btn{position:fixed;right:20px;bottom:20px;padding:10px 16px;background:#111;color:#fff;border:none;border-radius:8px;cursor:pointer;z-index:9999;box-shadow:0 4px 12px rgba(0,0,0,.2)}
</style>
</head>
<body>

<header>
  <div style="background:#0f172a;color:#fff;padding:10px 14px;text-align:center;font-size:14px">
    Private MVP · 100% client-side · Nothing leaves your browser
  </div>
  <div class="hero">
    <h1>Every Idea. One Click. Global Reach.</h1>
    <p class="lead">GIAP gives every idea a unique, permanent address at birth — no gatekeepers, no delay. You think it, and it’s connected.</p>
  </div>
</header>

<main>
  <section class="card" id="demo">
    <h2>1) Capture Idea → Assign Address</h2>
    <textarea id="idea" placeholder="Write your idea here…"></textarea>
    <div class="row">
      <button id="btn-churchen">Assign Address (churchen)</button>
      <button id="btn-clear" class="secondary">Clear</button>
    </div>
    <p class="muted">Everything runs locally in your browser. Stored only in your LocalStorage.</p>
  </section>

  <section class="card" id="result" style="display:none">
    <h2>Address</h2>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <div><label>IdeaID</label><input id="ideaId" type="text" readonly /></div>
      <div><label>Content Hash (SHA-256)</label><input id="hash" type="text" readonly /></div>
    </div>
    <div class="row" style="margin-top:10px">
      <button id="btn-copy" class="secondary">Copy IdeaID</button>
      <button id="btn-copy-url" class="secondary">Copy Permalink</button>
    </div>
    <p class="muted">Permalink scheme: <code>giap://&lt;IdeaID&gt;</code> · Web: <code>?id=&lt;IdeaID&gt;</code></p>
  </section>

  <section class="card">
    <h2>2) Local Register</h2>
    <table class="table" id="tbl">
      <thead><tr><th>IdeaID</th><th>Preview</th><th>Date</th><th>Action</th></tr></thead>
      <tbody></tbody>
    </table>
    <div class="row" style="margin-top:8px">
      <button id="btn-export" class="secondary">Export (.json)</button>
      <label class="secondary" style="border:1px solid #111;padding:9px 12px;border-radius:10px;background:#fff;cursor:pointer">
        Import (.json)
        <input type="file" id="file-import" accept="application/json" style="display:none">
      </label>
    </div>
  </section>

  <section class="card">
    <h2>3) (Optional) Tags</h2>
    <p class="muted">For later relevance matching – stored locally with the idea.</p>
    <input id="tags" type="text" placeholder="e.g. water, solar, protocol" />
  </section>
</main>

<button id="judge-btn">Judge This Idea</button>

<script>
(function(){
  'use strict';

  const STORAGE_KEY = 'giap_registry_v1';
  const $ = sel => document.querySelector(sel);
  const taIdea = $('#idea'), inpTags = $('#tags');
  const btnChurch = $('#btn-churchen'), btnClear = $('#btn-clear');
  const secResult = $('#result'), outId = $('#ideaId'), outHash = $('#hash');
  const btnCopyId = $('#btn-copy'), btnCopyUrl = $('#btn-copy-url');
  const tblBody = document.querySelector('#tbl tbody');
  const btnExport = $('#btn-export'), inpImport = $('#file-import');
  const btnJudge = $('#judge-btn');

  // Helpers
  const todayStr = ()=>new Date().toISOString().slice(0,10).replace(/-/g,'');
  function parseTags(s){ return (s||'').split(',').map(t=>t.trim()).filter(Boolean); }
  function readReg(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'); }catch{ return []; } }
  function writeReg(v){ localStorage.setItem(STORAGE_KEY, JSON.stringify(v)); }
  async function sha256Hex(str){
    const enc = new TextEncoder().encode(str);
    const buf = await crypto.subtle.digest('SHA-256', enc);
    return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
  }
  function ideaIdFrom(hashPrefix){ return `giap:${todayStr()}-${hashPrefix}`; }

  // Render registry
  function render(){
    const list = readReg().sort((a,b)=>b.date-a.date);
    tblBody.innerHTML = '';
    for (const it of list){
      const tr = document.createElement('tr');

      const tdId = document.createElement('td');
      // Link + Kopieren/Teilen
      const a = document.createElement('a'); a.href = '?id='+encodeURIComponent(it.id); a.textContent = it.id;
      const bCopy = document.createElement('button'); bCopy.textContent='kopieren'; bCopy.className='pill-btn';
      bCopy.onclick = async (e)=>{e.preventDefault(); try{ await navigator.clipboard.writeText(it.id);}catch{} };
      const bShare = document.createElement('button'); bShare.textContent='teilen'; bShare.className='pill-btn';
      bShare.onclick = async (e)=>{ e.preventDefault(); const url = location.origin+location.pathname+'?id='+encodeURIComponent(it.id);
        if(navigator.share){ try{ await navigator.share({title:'GIAP Idea', text:it.id, url}); }catch{} } else {
          try{ await navigator.clipboard.writeText(url);}catch{} }
      };
      tdId.appendChild(a); tdId.appendChild(document.createTextNode(' ')); tdId.appendChild(bCopy); tdId.appendChild(document.createTextNode(' ')); tdId.appendChild(bShare);
      tr.appendChild(tdId);

      const tdPrev = document.createElement('td'); tdPrev.textContent = it.title || '(no title)'; tr.appendChild(tdPrev);
      const tdDate = document.createElement('td'); tdDate.textContent = new Date(it.date||Date.now()).toLocaleString(); tr.appendChild(tdDate);

      const tdAct = document.createElement('td');
      const bLoad = document.createElement('button'); bLoad.textContent='laden'; bLoad.className='pill-btn';
      bLoad.onclick = ()=>{ taIdea.value=it.title||''; inpTags.value=(it.tags||[]).join(', '); window.scrollTo({top:0,behavior:'smooth'}); };
      const bDel = document.createElement('button'); bDel.textContent='löschen'; bDel.className='pill-btn';
      bDel.onclick = ()=>{ const cur = readReg().filter(x=>x.id!==it.id); writeReg(cur); render(); };
      tdAct.appendChild(bLoad); tdAct.appendChild(document.createTextNode(' ')); tdAct.appendChild(bDel);
      tr.appendChild(tdAct);

      tblBody.appendChild(tr);
    }
  }

  // Churchen
  btnChurch.addEventListener('click', async ()=>{
    const title = (taIdea.value||'').trim();
    const tags = parseTags(inpTags.value);
    if (!title){ alert('Please write your idea first.'); return; }
    const hash = await sha256Hex(title + '||' + tags.join('|'));
    const id = ideaIdFrom(hash.slice(0,10));
    const entry = { id, title, tags, hash, date: Date.now() };

    const reg = readReg();
    if (!reg.some(x=>x.id===id)) reg.push(entry);
    writeReg(reg);

    outId.value = id; outHash.value = hash; secResult.style.display = '';
    render();
  });

  btnClear.addEventListener('click', ()=>{ taIdea.value=''; inpTags.value=''; secResult.style.display='none'; outId.value=''; outHash.value=''; });

  // Copy buttons
  btnCopyId.addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(outId.value||''); }catch{} });
  btnCopyUrl.addEventListener('click', async ()=>{
    const url = location.origin + location.pathname + '?id=' + encodeURIComponent(outId.value||'');
    try{ await navigator.clipboard.writeText(url); }catch{}
  });

  // Export / Import
  btnExport.addEventListener('click', ()=>{
    const blob = new Blob([JSON.stringify(readReg(), null, 2)], {type:'application/json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'giap_registry.json'; a.click();
    setTimeout(()=>URL.revokeObjectURL(a.href), 800);
  });
  inpImport.addEventListener('change', (e)=>{
    const file = e.target.files && e.target.files[0]; if(!file) return;
    const fr = new FileReader();
    fr.onload = ()=>{
      try{
        const data = JSON.parse(fr.result||'[]');
        const cur = readReg();
        const map = new Map(cur.map(x=>[x.id,x]));
        for (const it of (Array.isArray(data)?data:[])){ if (it && it.id && !map.has(it.id)) map.set(it.id, it); }
        writeReg(Array.from(map.values()));
        render();
        alert('Import OK');
      }catch{ alert('Import failed'); }
    };
    fr.readAsText(file);
  });

  // Deep link ?id=
  (function handleDeepLink(){
    const id = new URLSearchParams(location.search).get('id'); if(!id) return;
    const reg = readReg(); const found = reg.find(x=>x.id===id);
    outId.value = id; outHash.value = found? (found.hash||'') : ''; secResult.style.display = '';
    document.getElementById('result').scrollIntoView({behavior:'smooth'});
  })();

  // Judge
  function jaccard(a=[], b=[]){
    const A=new Set(a.map(x=>String(x).toLowerCase()));
    const B=new Set(b.map(x=>String(x).toLowerCase()));
    const inter=[...A].filter(x=>B.has(x)).length;
    const uni=new Set([...A,...B]).size||1;
    return inter/uni;
  }
  function ensureMin2(){
    let r = readReg();
    if (r.length >= 2) return r;
    const t = todayStr();
    const seed = [
      { id:`giap:${t}-seedA`, title:'Student in Nairobi: water filter', tags:['water','innovation','sustainability'], date: Date.now() },
      { id:`giap:${t}-seedB`, title:'Solar saline plantage', tags:['solar','desalination','sustainability'], date: Date.now() }
    ];
    if (r.length === 0) r = seed; else if (r.length === 1) r.push(seed[1]);
    writeReg(r); return r;
  }
  function showOverlay(a,b,score){
    const old = document.getElementById('judge-overlay'); if(old) old.remove();
    const o = document.createElement('div'); o.id='judge-overlay';
    const c = document.createElement('div'); c.id='judge-card';
    c.innerHTML = `
      <h3 style="margin:0 0 10px">How GIAP links ideas</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div style="border:1px solid #eee;border-radius:8px;padding:10px">
          <div style="font-weight:700">Idea A</div>
          <div><small>${a.id}</small></div>
          <div style="margin-top:6px">${a.title||'(no title)'}</div>
          <div style="color:#555;margin-top:6px"><small>Tags: ${(a.tags||[]).join(', ')||'—'}</small></div>
        </div>
        <div style="border:1px solid #eee;border-radius:8px;padding:10px">
          <div style="font-weight:700">Idea B</div>
          <div><small>${b.id}</small></div>
          <div style="margin-top:6px">${b.title||'(no title)'}</div>
          <div style="color:#555;margin-top:6px"><small>Tags: ${(b.tags||[]).join(', ')||'—'}</small></div>
        </div>
      </div>
      <div style="margin:12px 0 6px">Similarity (tags): <b>${(score*100).toFixed(0)}%</b></div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
        <button id="judge-close" class="secondary">Close</button>
      </div>`;
    o.appendChild(c); document.body.appendChild(o);
    $('#judge-close').onclick=()=>o.remove();
  }
  btnJudge.addEventListener('click', ()=>{
    const reg = ensureMin2();
    const i = Math.floor(Math.random()*reg.length);
    let j = Math.floor(Math.random()*reg.length); if (reg.length>1) while (j===i) j = Math.floor(Math.random()*reg.length);
    const A = reg[i], B = reg[j];
    showOverlay(A,B, jaccard(A.tags||[], B.tags||[]));
  });

  // Initial render
  render();
})();
</script>
  <script>
/* Autofill aus ?idea=... (&tags=... optional) und auto-churchen */
(function () {
  const sp = new URLSearchParams(location.search);
  const idea = sp.get('idea');
  if (!idea) return;

  const ideaEl = document.getElementById('idea');
  const tagsEl = document.getElementById('tags');
  const btn = document.getElementById('btn-churchen');

  // URLSearchParams ist bereits decodiert; '+'-Fallback nur zur Sicherheit
  ideaEl.value = idea.replace(/\+/g, ' ');

  const tags = sp.get('tags');
  if (tags) tagsEl.value = tags;

  // Automatisch „Assign Address“ auslösen, wenn ?auto=1
  if ((sp.get('auto') || '') === '1') {
    // kurz warten bis alles gemountet ist
    setTimeout(() => btn.click(), 50);
  }
})();
</script>
</body>
</html>
